<!DOCTYPE html>
<html lang="en">

<head>
	<title>Snake.City</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<!-- import the webpage's stylesheet -->
	<link rel="stylesheet" href="game.css">
	<link href="https://fonts.googleapis.com/css2?family=Sarpanch:wght@400;600;800&display=swap" rel="stylesheet">

	<script src="/connect.js" defer></script>
</head>

<body class="nobg">
	<div id="other">

		<div id="TopLogo">Snake <br> City</div>

		<form action="create.html">	
			<button id="createbutton">?</button>  
		 </form>	

		
		 <div class="explantionBox">
		<div class="gameText"> Want to start a new game session? Start here!</div>
		<br>

		<form action="game">
			<button id="startgame">START NEW GAME</button>
		</form>
		<br>
		<br>


		<div class="gameText">Or select the ongoing session from below to join </div>

			<div id="otherSnake" class="gameText">
				<p id="snakeId">-There are no snakes to join-</p>
			</div>
		</div>

		<div id="bodytext">


		



			<script>

				// Ask for the list of snakes in play
				function onOpen() {
					console.log("onOpen");
					ws.send("list");
				}

				// Get the list of snakes and print them on screen
				function onMessage(e) {
					if (typeof e.data === 'string') {
						console.log("Received from server: " + e.data);

						var x = document.getElementById("snakeId");

						var snakes = Object.entries(JSON.parse(e.data));

						for (let [key, value] of snakes) {
							//Get name of the snake
							let snakeNames = value["snakeName"];
							let playerNumber = value["numPlayers"]; 
							let snakePassword = value["snakePassword"];
							let snakeURLs = "http://snake.city/game/" + value["snakeUuid"] + "/" ;
							
							//Create a a-HTML element for each available room
							let snakeJoin = document.createElement("div");
							snakeJoin.setAttribute("id", "snakeid");

							//Assign Name to the newly created div element
							let nameHTML = document.createTextNode(snakeNames + " - Number of players : " + playerNumber);
							snakeJoin.appendChild(nameHTML);

							//attach function that activates on click
							snakeJoin.addEventListener('click', function() {
   							passwordInput(snakeURLs, snakePassword);
							});

							//Append it the original HTML
							let element = document.getElementById("otherSnake");
							element.appendChild(snakeJoin);
						}
						x.innerText = "Click on the snake to join";
					}

				};

				function passwordInput(url, pass) {
					let inputPassword = prompt("Enter the 4 digit number password to join this session", "****");
					switch (inputPassword) {
						case pass:
							window.location.replace(url + pass);
							break;
						default:
						window.location.replace("http://snake.city")

					}
				};

			</script>
		</div>

</body>

<style>
    #snakeid {
      color: white;
      padding: 10px;
	  margin-bottom: 10px;
	  border: 1px solid white;
	  border-radius: 15px;
      text-align: center;
      cursor: pointer;
    }
</style>

</html>